@page "/admin/dashboard"
@model Shopify.Presentation.RazorPages.Pages.Area.Admin.Pages.DashboardModel
@{
    Layout = "Admin/Shared/_AdminLayout";
}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    body {
        font-family: 'Vazirmatn', sans-serif;
        background-color: #f8f9fa;
        overflow-x: hidden;
    }

    #wrapper {
        display: flex;
        width: 100%;
    }

    #sidebar-wrapper {
        min-height: 100vh;
        width: 260px;
        margin-right: 0;
        transition: margin 0.25s ease-out;
        background-color: #1e293b;
        color: white;
    }

        #sidebar-wrapper .list-group-item {
            background-color: transparent;
            color: #cbd5e1;
            border: none;
            padding: 12px 20px;
        }

            #sidebar-wrapper .list-group-item:hover, #sidebar-wrapper .list-group-item.active {
                background-color: #00acc1;
                color: white;
                border-radius: 8px;
                margin: 0 10px;
            }

    #page-content-wrapper {
        width: 100%;
    }

    .stat-card {
        transition: transform 0.2s;
    }

        .stat-card:hover {
            transform: translateY(-5px);
        }

    .toggled #sidebar-wrapper {
        margin-right: -260px;
    }

    @@media (max-width: 768px) {
        #sidebar-wrapper {
            margin-right: -260px;
        }

        .toggled #sidebar-wrapper {
            margin-right: 0;
        }
    }
</style>

<div class="container-fluid p-4">
    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="card border-0 shadow-sm rounded-4 bg-primary text-white stat-card h-100">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-white-50 small mb-1">فروش کل</h6>
                            <h3 class="fw-bold mb-0">@Model.TotalOrderMoney} م‌ت</h3>
                        </div>
                        <i class="bi bi-currency-dollar fs-1 opacity-50"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card border-0 shadow-sm rounded-4 bg-white stat-card h-100">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted small mb-1">سفارشات جدید (امروز)</h6>
                            <h3 class="fw-bold text-gray-800 mb-0">@Model.TotalOrders</h3>
                        </div>
                        <div class="bg-indigo-100 text-indigo-600 rounded-3 p-2">
                            <i class="bi bi-bag fs-3"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card border-0 shadow-sm rounded-4 bg-white stat-card h-100">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted small mb-1">تعداد کاربران</h6>
                            <h3 class="fw-bold text-gray-800 mb-0">@Model.TotalUsers</h3>
                        </div>
                        <div class="bg-green-100 text-green-600 rounded-3 p-2">
                            <i class="bi bi-people fs-3"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card border-0 shadow-sm rounded-4 bg-white stat-card h-100">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted small mb-1">محصولات</h6>
                            <h3 class="fw-bold text-gray-800 mb-0">@Model.TotalProducts</h3>
                        </div>
                        <div class="bg-orange-100 text-orange-600 rounded-3 p-2">
                            <i class="bi bi-box fs-3"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- نمودارها -->
    <div class="row g-4 mb-4">
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm rounded-4 h-100">
                <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center border-0">
                    <h6 class="mb-0 fw-bold text-gray-700">
                        <i class="bi bi-graph-up-arrow me-2 text-primary"></i>آمار فروش و سفارشات (۷ روز اخیر)
                    </h6>
                    <select class="form-select w-auto text-sm border-0 bg-light">
                        <option selected>۷ روز گذشته</option>
                        <option>۳۰ روز گذشته</option>
                    </select>
                </div>
                <div class="card-body">
                    <canvas id="salesChart"></canvas>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card border-0 shadow-sm rounded-4 h-100">
                <div class="card-header bg-white py-3 border-0">
                    <h6 class="mb-0 fw-bold text-gray-700">
                        <i class="bi bi-pie-chart me-2 text-primary"></i>وضعیت موجودی محصولات
                    </h6>
                </div>
                <div class="card-body d-flex align-items-center justify-content-center">
                    <div style="width: 280px; height: 280px;">
                        <canvas id="productsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="card border-0 shadow-sm rounded-4">
        <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
            <h6 class="mb-0 fw-bold">آخرین سفارشات ثبت شده</h6>
            <a href="#" class="btn btn-sm btn-outline-primary rounded-pill">مشاهده همه</a>
        </div>
        <div class="table-responsive">
            <table class="table align-middle mb-0 table-hover">
                <thead class="bg-light">
                    <tr>
                        <th class="ps-4">شناسه</th>
                        <th>کاربر</th>
                        <th>تاریخ</th>
                        <th>مبلغ کل</th>
                        <th>وضعیت</th>
                        <th>عملیات</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="ps-4 fw-bold">#ORD-1024</td>
                        <td>علی محمدی</td>
                        <td class="text-muted text-sm">1403/09/08</td>
                        <td class="fw-bold">2,500,000</td>
                        <td><span class="badge bg-success-subtle text-success px-3 rounded-pill">پرداخت شده</span></td>
                        <td><button class="btn btn-sm btn-light border"><i class="bi bi-eye"></i></button></td>
                    </tr>
                    <tr>
                        <td class="ps-4 fw-bold">#ORD-1023</td>
                        <td>سارا امیری</td>
                        <td class="text-muted text-sm">1403/09/08</td>
                        <td class="fw-bold">850,000</td>
                        <td><span class="badge bg-warning-subtle text-warning px-3 rounded-pill">در انتظار</span></td>
                        <td><button class="btn btn-sm btn-light border"><i class="bi bi-eye"></i></button></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        Chart.defaults.font.family = "'Vazirmatn', sans-serif";
        Chart.defaults.color = '#64748b';

        const ctxSales = document.getElementById('salesChart').getContext('2d');
        new Chart(ctxSales, {
            type: 'bar',
            data: {
                labels: ['شنبه', 'یکشنبه', 'دوشنبه', 'سه‌شنبه', 'چهارشنبه', 'پنج‌شنبه', 'جمعه'],
                datasets: [
                    {
                        label: 'تعداد سفارشات',
                        data: [12, 19, 3, 5, 2, 3, 10], 
                        backgroundColor: 'rgba(0, 172, 193, 0.2)',
                        borderColor: 'rgba(0, 172, 193, 1)',
                        borderWidth: 1,
                        yAxisID: 'y',
                        borderRadius: 8
                    },
                    {
                        label: 'مجموع فروش (میلیون تومان)',
                        data: [150, 230, 45, 80, 20, 40, 120], 
                        type: 'line',
                        borderColor: '#ff9800',
                        backgroundColor: '#ff9800',
                        borderWidth: 3,
                        tension: 0.4,
                        yAxisID: 'y1',
                        fill: false
                    }
                ]
            },
            options: {
                responsive: true,
                interaction: { mode: 'index', intersect: false },
                plugins: { legend: { position: 'top', align: 'end' } },
                scales: {
                    y: {
                        type: 'linear',
                        position: 'left',
                        title: { display: true, text: 'تعداد سفارش' },
                        grid: { drawOnChartArea: true }
                    },
                    y1: {
                        type: 'linear',
                        position: 'right',
                        title: { display: true, text: 'مبلغ فروش (میلیون تومان)' },
                        grid: { drawOnChartArea: false }
                    }
                }
            }
        });

        const ctxProducts = document.getElementById('productsChart').getContext('2d');
        new Chart(ctxProducts, {
            type: 'doughnut',
            data: {
                labels: ['موجود در انبار', 'ناموجود', 'رو به اتمام'],
                datasets: [{
                    data: [
                        @Model.ProductsInStock,
                        @Model.ProductsOutOfStock,
                        @Model.ProductsRunningLow
                    ],
                    backgroundColor: ['#22c55e', '#ef4444', '#f59e0b'],
                    borderWidth: 0,
                    hoverOffset: 10
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'bottom' },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.label || '';
                                if (label) label += ': ';
                                label += context.raw + ' محصول';
                                return label;
                            }
                        }
                    }
                },
                cutout: '70%'
            }
        });
    </script>
}